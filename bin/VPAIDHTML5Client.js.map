{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","js/IVPAIDAdUnit.js","js/VPAIDAdUnit.js","js/VPAIDHTML5Client.js","js/subscriber.js","js/utils.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VPAIDHTML5Client.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\r\n\r\nvar METHODS = [\r\n    'handshakeVersion',\r\n    'initAd',\r\n    'startAd',\r\n    'stopAd',\r\n    'skipAd', // VPAID 2.0 new method\r\n    'resizeAd',\r\n    'pauseAd',\r\n    'resumeAd',\r\n    'expandAd',\r\n    'collapseAd',\r\n    'subscribe',\r\n    'unsubscribe'\r\n];\r\n\r\nvar EVENTS = [\r\n    'AdLoaded',\r\n    'AdStarted',\r\n    'AdStopped',\r\n    'AdSkipped',\r\n    'AdSkippableStateChange', // VPAID 2.0 new event\r\n    'AdSizeChange', // VPAID 2.0 new event\r\n    'AdLinearChange',\r\n    'AdDurationChange', // VPAID 2.0 new event\r\n    'AdExpandedChange',\r\n    'AdRemainingTimeChange', // [Deprecated in 2.0] but will be still fired for backwards compatibility\r\n    'AdVolumeChange',\r\n    'AdImpression',\r\n    'AdVideoStart',\r\n    'AdVideoFirstQuartile',\r\n    'AdVideoMidpoint',\r\n    'AdVideoThirdQuartile',\r\n    'AdVideoComplete',\r\n    'AdClickThru',\r\n    'AdInteraction', // VPAID 2.0 new event\r\n    'AdUserAcceptInvitation',\r\n    'AdUserMinimize',\r\n    'AdUserClose',\r\n    'AdPaused',\r\n    'AdPlaying',\r\n    'AdLog',\r\n    'AdError'\r\n];\r\n\r\nvar GETTERS = [\r\n    'getAdLinear',\r\n    'getAdWidth', // VPAID 2.0 new getter\r\n    'getAdHeight', // VPAID 2.0 new getter\r\n    'getAdExpanded',\r\n    'getAdSkippableState', // VPAID 2.0 new getter\r\n    'getAdRemainingTime',\r\n    'getAdDuration', // VPAID 2.0 new getter\r\n    'getAdVolume',\r\n    'getAdCompanions', // VPAID 2.0 new getter\r\n    'getAdIcons' // VPAID 2.0 new getter\r\n];\r\n\r\nvar SETTERS = [\r\n    'setAdVolume'\r\n];\r\n\r\n\r\n/**\r\n * This callback is displayed as global member. The callback use nodejs error-first callback style\r\n * @callback NodeStyleCallback\r\n * @param {string|null}\r\n * @param {undefined|object}\r\n */\r\n\r\n\r\n/**\r\n * IVPAIDAdUnit\r\n *\r\n * @class\r\n *\r\n * @param {object} creative\r\n * @param {HTMLElement} el\r\n * @param {HTMLVideoElement} video\r\n */\r\nfunction IVPAIDAdUnit(creative, el, video) {}\r\n\r\n\r\n/**\r\n * handshakeVersion\r\n *\r\n * @param {string} VPAIDVersion\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.handshakeVersion = function (VPAIDVersion, callback) {};\r\n\r\n/**\r\n * initAd\r\n *\r\n * @param {number} width\r\n * @param {number} height\r\n * @param {string} viewMode can be 'normal', 'thumbnail' or 'fullscreen'\r\n * @param {number} desiredBitrate indicates the desired bitrate in kbps\r\n * @param {object} [creativeData] used for additional initialization data\r\n * @param {object} [environmentVars] used for passing implementation-specific of js version\r\n * @param {NodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.initAd = function(width, height, viewMode, desiredBitrate, creativeData, environmentVars, callback) {};\r\n\r\n/**\r\n * startAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.startAd = function(callback) {};\r\n\r\n/**\r\n * stopAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.stopAd = function(callback) {};\r\n\r\n/**\r\n * skipAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.skipAd = function(callback) {};\r\n\r\n/**\r\n * resizeAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.resizeAd = function(width, height, viewMode, callback) {};\r\n\r\n/**\r\n * pauseAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.pauseAd = function(callback) {};\r\n\r\n/**\r\n * resumeAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.resumeAd = function(callback) {};\r\n\r\n/**\r\n * expandAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.expandAd = function(callback) {};\r\n\r\n/**\r\n * collapseAd\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.collapseAd = function(callback) {};\r\n\r\n/**\r\n * subscribe\r\n *\r\n * @param {string} event\r\n * @param {nodeStyleCallback} handler\r\n * @param {object} context\r\n */\r\nIVPAIDAdUnit.prototype.subscribe = function(event, handler, context) {};\r\n\r\n/**\r\n * startAd\r\n *\r\n * @param {string} event\r\n * @param {function} handler\r\n */\r\nIVPAIDAdUnit.prototype.unsubscribe = function(event, handler) {};\r\n\r\n\r\n\r\n/**\r\n * getAdLinear\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdLinear = function(callback) {};\r\n\r\n/**\r\n * getAdWidth\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdWidth = function(callback) {};\r\n\r\n/**\r\n * getAdHeight\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdHeight = function(callback) {};\r\n\r\n/**\r\n * getAdExpanded\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdExpanded = function(callback) {};\r\n\r\n/**\r\n * getAdSkippableState\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdSkippableState = function(callback) {};\r\n\r\n/**\r\n * getAdRemainingTime\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdRemainingTime = function(callback) {};\r\n\r\n/**\r\n * getAdDuration\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdDuration = function(callback) {};\r\n\r\n/**\r\n * getAdVolume\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdVolume = function(callback) {};\r\n\r\n/**\r\n * getAdCompanions\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdCompanions = function(callback) {};\r\n\r\n/**\r\n * getAdIcons\r\n *\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.getAdIcons = function(callback) {};\r\n\r\n/**\r\n * setAdVolume\r\n *\r\n * @param {number} volume\r\n * @param {nodeStyleCallback} callback\r\n */\r\nIVPAIDAdUnit.prototype.setAdVolume = function(volume, callback) {};\r\n\r\naddStaticToInterface(IVPAIDAdUnit, 'METHODS', METHODS);\r\naddStaticToInterface(IVPAIDAdUnit, 'GETTERS', GETTERS);\r\naddStaticToInterface(IVPAIDAdUnit, 'SETTERS', SETTERS);\r\naddStaticToInterface(IVPAIDAdUnit, 'EVENTS',  EVENTS);\r\n\r\n\r\nvar VPAID1_METHODS = METHODS.filter(function(method) {\r\n    return ['skipAd'].indexOf(method) === -1;\r\n});\r\n\r\naddStaticToInterface(IVPAIDAdUnit, 'checkVPAIDInterface', function checkVPAIDInterface (creative) {\r\n    var result = VPAID1_METHODS.every(function(key) {\r\n        return typeof creative[key] === 'function';\r\n    });\r\n    return result;\r\n});\r\n\r\nmodule.exports = IVPAIDAdUnit;\r\n\r\nfunction addStaticToInterface(Interface, name, value) {\r\n    Object.defineProperty(Interface, name, {\r\n        writable: false,\r\n        configurable: false,\r\n        value: value\r\n    });\r\n}\r\n\r\n","'use strict';\r\n\r\nvar IVPAIDAdUnit = require('./IVPAIDAdUnit');\r\nvar Subscriber = require('./subscriber');\r\nvar checkVPAIDInterface = IVPAIDAdUnit.checkVPAIDInterface;\r\nvar utils = require('./utils');\r\nvar METHODS = IVPAIDAdUnit.METHODS;\r\nvar ERROR = 'AdError';\r\nvar AD_CLICK = 'AdClickThru';\r\nvar FILTERED_EVENTS = IVPAIDAdUnit.EVENTS.filter(function (event) {\r\n    return event != AD_CLICK;\r\n});\r\n\r\n/**\r\n * This callback is displayed as global member. The callback use nodejs error-first callback style\r\n * @callback NodeStyleCallback\r\n * @param {string|null}\r\n * @param {undefined|object}\r\n */\r\n\r\n\r\n/**\r\n * VPAIDAdUnit\r\n * @class\r\n *\r\n * @param VPAIDCreative\r\n * @param {HTMLElement} [el] this will be used in initAd environmentVars.slot if defined\r\n * @param {HTMLVideoElement} [video] this will be used in initAd environmentVars.videoSlot if defined\r\n */\r\nfunction VPAIDAdUnit(VPAIDCreative, el, video, iframe) {\r\n    this._isValid = checkVPAIDInterface(VPAIDCreative);\r\n    if (this._isValid) {\r\n        this._creative = VPAIDCreative;\r\n        this._el = el;\r\n        this._videoEl = video;\r\n        this._iframe = iframe;\r\n        this._subscribers = new Subscriber();\r\n        utils.setFullSizeStyle(el);\r\n        $addEventsSubscribers.call(this);\r\n    }\r\n}\r\n\r\nVPAIDAdUnit.prototype = Object.create(IVPAIDAdUnit.prototype);\r\n\r\n/**\r\n * isValidVPAIDAd will return if the VPAIDCreative passed in constructor is valid or not\r\n *\r\n * @return {boolean}\r\n */\r\nVPAIDAdUnit.prototype.isValidVPAIDAd = function isValidVPAIDAd() {\r\n    return this._isValid;\r\n};\r\n\r\nIVPAIDAdUnit.METHODS.forEach(function(method) {\r\n    //NOTE: this methods arguments order are implemented differently from the spec\r\n    var ignores = [\r\n        'subscribe',\r\n        'unsubscribe',\r\n        'initAd'\r\n    ];\r\n\r\n    if (ignores.indexOf(method) !== -1) return;\r\n\r\n    VPAIDAdUnit.prototype[method] = function () {\r\n        var ariaty = IVPAIDAdUnit.prototype[method].length;\r\n        // TODO avoid leaking arguments\r\n        // https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#32-leaking-arguments\r\n        var args = Array.prototype.slice.call(arguments);\r\n        var callback = (ariaty === args.length) ? args.pop() : undefined;\r\n\r\n        setTimeout(function () {\r\n            var result, error = null;\r\n            try {\r\n                result = this._creative[method].apply(this._creative, args);\r\n            } catch(e) {\r\n                error = e;\r\n            }\r\n\r\n            callOrTriggerEvent(callback, this._subscribers, error, result);\r\n        }.bind(this), 0);\r\n    };\r\n});\r\n\r\n\r\n/**\r\n * initAd concreate implementation\r\n *\r\n * @param {number} width\r\n * @param {number} height\r\n * @param {string} viewMode can be 'normal', 'thumbnail' or 'fullscreen'\r\n * @param {number} desiredBitrate indicates the desired bitrate in kbps\r\n * @param {object} [creativeData] used for additional initialization data\r\n * @param {object} [environmentVars] used for passing implementation-specific of js version, if el & video was used in constructor slot & videoSlot will be added to the object\r\n * @param {NodeStyleCallback} callback\r\n */\r\nVPAIDAdUnit.prototype.initAd = function initAd(width, height, viewMode, desiredBitrate, creativeData, environmentVars, callback) {\r\n    creativeData = creativeData || {};\r\n    environmentVars = utils.extend({\r\n        slot: this._el,\r\n        videoSlot: this._videoEl\r\n    }, environmentVars || {});\r\n\r\n    setTimeout(function () {\r\n        var error;\r\n        try {\r\n            this._creative.initAd(width, height, viewMode, desiredBitrate, creativeData, environmentVars);\r\n        } catch (e) {\r\n            error = e;\r\n        }\r\n\r\n        callOrTriggerEvent(callback, this._subscribers, error);\r\n    }.bind(this), 0);\r\n};\r\n\r\n/**\r\n * subscribe\r\n *\r\n * @param {string} event\r\n * @param {nodeStyleCallback} handler\r\n * @param {object} context\r\n */\r\nVPAIDAdUnit.prototype.subscribe = function subscribe(event, handler, context) {\r\n    this._subscribers.subscribe(handler, event, context);\r\n};\r\n\r\n\r\n/**\r\n * unsubscribe\r\n *\r\n * @param {string} event\r\n * @param {nodeStyleCallback} handler\r\n */\r\nVPAIDAdUnit.prototype.unsubscribe = function unsubscribe(event, handler) {\r\n    this._subscribers.unsubscribe(handler, event);\r\n};\r\n\r\n//alias\r\nVPAIDAdUnit.prototype.on = VPAIDAdUnit.prototype.subscribe;\r\nVPAIDAdUnit.prototype.off = VPAIDAdUnit.prototype.unsubscribe;\r\n\r\nIVPAIDAdUnit.GETTERS.forEach(function(getter) {\r\n    VPAIDAdUnit.prototype[getter] = function (callback) {\r\n        setTimeout(function () {\r\n\r\n            var result, error = null;\r\n            try {\r\n                result = this._creative[getter]();\r\n            } catch(e) {\r\n                error = e;\r\n            }\r\n\r\n            callOrTriggerEvent(callback, this._subscribers, error, result);\r\n        }.bind(this), 0);\r\n    };\r\n});\r\n\r\n/**\r\n * setAdVolume\r\n *\r\n * @param volume\r\n * @param {nodeStyleCallback} callback\r\n */\r\nVPAIDAdUnit.prototype.setAdVolume = function setAdVolume(volume, callback) {\r\n    setTimeout(function () {\r\n\r\n        var result, error = null;\r\n        try {\r\n            this._creative.setAdVolume(volume);\r\n            result = this._creative.getAdVolume();\r\n        } catch(e) {\r\n            error = e;\r\n        }\r\n\r\n        if (!error) {\r\n            error = utils.validate(result === volume, 'failed to apply volume: ' + volume);\r\n        }\r\n        callOrTriggerEvent(callback, this._subscribers, error, result);\r\n    }.bind(this), 0);\r\n};\r\n\r\nVPAIDAdUnit.prototype._destroy = function destroy() {\r\n    this.stopAd();\r\n    this._subscribers.unsubscribeAll();\r\n};\r\n\r\nfunction $addEventsSubscribers() {\r\n    // some ads implement\r\n    // so they only handle one subscriber\r\n    // to handle this we create our one\r\n    FILTERED_EVENTS.forEach(function (event) {\r\n        this._creative.subscribe($trigger.bind(this, event), event);\r\n    }.bind(this));\r\n\r\n    // map the click event to be an object instead of depending of the order of the arguments\r\n    // and to be consistent with the flash\r\n    this._creative.subscribe($clickThruHook.bind(this), AD_CLICK);\r\n\r\n    // because we are adding the element inside the iframe\r\n    // the user is not able to click in the video\r\n    if (this._videoEl) {\r\n        var documentElement = this._iframe.contentDocument.documentElement;\r\n        var videoEl = this._videoEl;\r\n        documentElement.addEventListener('click', function(e) {\r\n            if (e.target === documentElement) {\r\n                videoEl.click();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction $clickThruHook(url, id, playerHandles) {\r\n    this._subscribers.triggerSync(AD_CLICK, {url: url, id: id, playerHandles: playerHandles});\r\n}\r\n\r\nfunction $trigger(event) {\r\n    // TODO avoid leaking arguments\r\n    // https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#32-leaking-arguments\r\n    this._subscribers.trigger(event, Array.prototype.slice(arguments, 1));\r\n}\r\n\r\nfunction callOrTriggerEvent(callback, subscribers, error, result) {\r\n    if (callback) {\r\n        callback(error, result);\r\n    } else if (error) {\r\n        subscribers.trigger(ERROR, error);\r\n    }\r\n}\r\n\r\nmodule.exports = VPAIDAdUnit;\r\n\r\n","'use strict';\r\n\r\nvar utils = require('./utils');\r\nvar unique = utils.unique('vpaidIframe');\r\nvar VPAIDAdUnit = require('./VPAIDAdUnit');\r\n\r\nvar defaultTemplate = '<!DOCTYPE html>' +\r\n    '<html lang=\"en\">' +\r\n    '<head><meta charset=\"UTF-8\"></head>' +\r\n    '<body style=\"margin:0;padding:0\"><div class=\"ad-element\"></div>' +\r\n    '<script type=\"text/javascript\" src=\"{{iframeURL_JS}}\"></script>' +\r\n    '<script type=\"text/javascript\">' +\r\n    'window.parent.postMessage(\\'{\"event\": \"ready\", \"id\": \"{{iframeID}}\"}\\', \\'{{origin}}\\');' +\r\n    '</script>' +\r\n    '</body>' +\r\n    '</html>';\r\n\r\nvar AD_STOPPED = 'AdStopped';\r\n\r\n/**\r\n * This callback is displayed as global member. The callback use nodejs error-first callback style\r\n * @callback NodeStyleCallback\r\n * @param {string|null}\r\n * @param {undefined|object}\r\n */\r\n\r\n/**\r\n * VPAIDHTML5Client\r\n * @class\r\n *\r\n * @param {HTMLElement} el that will contain the iframe to load adUnit and a el to add to adUnit slot\r\n * @param {HTMLVideoElement} video default video element to be used by adUnit\r\n * @param {object} [templateConfig] template: html template to be used instead of the default, extraOptions: to be used when rendering the template\r\n * @param {object} [vpaidOptions] timeout: when loading adUnit\r\n */\r\nfunction VPAIDHTML5Client(el, video, templateConfig, vpaidOptions) {\r\n    templateConfig = templateConfig || {};\r\n\r\n    this._id = unique();\r\n    this._destroyed = false;\r\n\r\n    this._frameContainer = utils.createElementInEl(el, 'div');\r\n    this._videoEl = video;\r\n    this._vpaidOptions = vpaidOptions || {timeout: 10000};\r\n\r\n    this._templateConfig = {\r\n        template: templateConfig.template || defaultTemplate,\r\n        extraOptions: templateConfig.extraOptions || {}\r\n    };\r\n}\r\n\r\n/**\r\n * destroy\r\n *\r\n */\r\nVPAIDHTML5Client.prototype.destroy = function destroy() {\r\n    if (this._destroyed) {\r\n        return;\r\n    }\r\n    this._destroyed = true;\r\n    $unloadPreviousAdUnit.call(this);\r\n};\r\n\r\n/**\r\n * isDestroyed\r\n *\r\n * @return {boolean}\r\n */\r\nVPAIDHTML5Client.prototype.isDestroyed = function isDestroyed() {\r\n    return this._destroyed;\r\n};\r\n\r\n/**\r\n * loadAdUnit\r\n *\r\n * @param {string} adURL url of the js of the adUnit\r\n * @param {nodeStyleCallback} callback\r\n */\r\nVPAIDHTML5Client.prototype.loadAdUnit = function loadAdUnit(adURL, callback) {\r\n    $throwIfDestroyed.call(this);\r\n    $unloadPreviousAdUnit.call(this);\r\n    var that = this;\r\n\r\n    var frame = utils.createIframeWithContent(\r\n        this._frameContainer,\r\n        this._templateConfig.template,\r\n        utils.extend({\r\n            iframeURL_JS: adURL,\r\n            iframeID: this.getID(),\r\n            origin: getOrigin()\r\n        }, this._templateConfig.extraOptions)\r\n    );\r\n\r\n    this._frame = frame;\r\n\r\n    this._onLoad = utils.callbackTimeout(\r\n        this._vpaidOptions.timeout,\r\n        onLoad.bind(this),\r\n        onTimeout.bind(this)\r\n    );\r\n\r\n    window.addEventListener('message', this._onLoad);\r\n\r\n    function onLoad (e) {\r\n        /*jshint validthis: false */\r\n        //don't clear timeout\r\n        if (e.origin !== getOrigin()) return;\r\n        var result;\r\n\r\n        try {\r\n            result = JSON.parse(e.data);\r\n        } catch (e) {\r\n            return;\r\n        }\r\n        //don't clear timeout\r\n        if (result.id !== that.getID()) return;\r\n\r\n        var adUnit, error, createAd;\r\n        if (!that._frame.contentWindow) {\r\n\r\n            error = 'the iframe is not anymore in the DOM tree';\r\n\r\n        } else {\r\n            createAd = that._frame.contentWindow.getVPAIDAd;\r\n            error = utils.validate(typeof createAd === 'function', 'the ad didn\\'t return a function to create an ad');\r\n        }\r\n\r\n        if (!error) {\r\n            var adEl = that._frame.contentWindow.document.querySelector('.ad-element');\r\n            adUnit = new VPAIDAdUnit(createAd(), adEl, that._videoEl, that._frame);\r\n            error = utils.validate(adUnit.isValidVPAIDAd(), 'the add is not fully complaint with VPAID specification');\r\n        }\r\n\r\n        that._adUnit = adUnit;\r\n        $destroyLoadListener.call(that);\r\n        callback(error, error ? null : adUnit);\r\n\r\n        //clear timeout\r\n        return true;\r\n    }\r\n\r\n    function onTimeout() {\r\n        callback('timeout', null);\r\n    }\r\n};\r\n\r\n/**\r\n * unloadAdUnit\r\n *\r\n */\r\nVPAIDHTML5Client.prototype.unloadAdUnit = function unloadAdUnit() {\r\n    $unloadPreviousAdUnit.call(this);\r\n};\r\n\r\n/**\r\n * getID will return the unique id\r\n *\r\n * @return {string}\r\n */\r\nVPAIDHTML5Client.prototype.getID = function () {\r\n    return this._id;\r\n};\r\n\r\n\r\n/**\r\n * $removeEl\r\n *\r\n * @param {string} key\r\n */\r\nfunction $removeEl(key) {\r\n    var el = this[key];\r\n    if (el) {\r\n        el.remove();\r\n        delete this[key];\r\n    }\r\n}\r\n\r\nfunction $adDestroyed() {\r\n    $removeAdElements.call(this);\r\n    delete this._adUnit;\r\n}\r\n\r\nfunction $unloadPreviousAdUnit() {\r\n    $removeAdElements.call(this);\r\n    $destroyAdUnit.call(this);\r\n}\r\n\r\nfunction $removeAdElements() {\r\n    $removeEl.call(this, '_frame');\r\n    $destroyLoadListener.call(this);\r\n}\r\n\r\n/**\r\n * $destroyLoadListener\r\n *\r\n */\r\nfunction $destroyLoadListener() {\r\n    if (this._onLoad) {\r\n        window.removeEventListener('message', this._onLoad);\r\n        utils.clearCallbackTimeout(this._onLoad);\r\n        delete this._onLoad;\r\n    }\r\n}\r\n\r\n\r\nfunction $destroyAdUnit() {\r\n    if (this._adUnit) {\r\n        this._adUnit.stopAd();\r\n        delete this._adUnit;\r\n    }\r\n}\r\n\r\n/**\r\n * $throwIfDestroyed\r\n *\r\n */\r\nfunction $throwIfDestroyed() {\r\n    if (this._destroyed) {\r\n        throw new Error ('VPAIDHTML5Client already destroyed!');\r\n    }\r\n}\r\n\r\nfunction getOrigin() {\r\n    if( window.location.origin ) {\r\n        return window.location.origin;\r\n    }\r\n    else {\r\n        return window.location.protocol + \"//\" +\r\n            window.location.hostname +\r\n            (window.location.port ? ':' + window.location.port: '');\r\n    }\r\n}\r\n\r\nmodule.exports = VPAIDHTML5Client;\r\n\r\n","'use strict';\r\n\r\nfunction Subscriber() {\r\n    this._subscribers = {};\r\n}\r\n\r\nSubscriber.prototype.subscribe = function subscribe(handler, eventName, context) {\r\n    if (!this.isHandlerAttached(handler, eventName)) {\r\n        this.get(eventName).push({handler: handler, context: context, eventName: eventName});\r\n    }\r\n};\r\n\r\nSubscriber.prototype.unsubscribe = function unsubscribe(handler, eventName) {\r\n    this._subscribers[eventName] = this.get(eventName).filter(function (subscriber) {\r\n        return handler !== subscriber.handler;\r\n    });\r\n};\r\n\r\nSubscriber.prototype.unsubscribeAll = function unsubscribeAll() {\r\n    this._subscribers = {};\r\n};\r\n\r\nSubscriber.prototype.trigger = function(eventName, data) {\r\n    var that = this;\r\n    var subscribers = this.get(eventName)\r\n        .concat(this.get('*'));\r\n\r\n    subscribers.forEach(function (subscriber) {\r\n        setTimeout(function () {\r\n            if (that.isHandlerAttached(subscriber.handler, subscriber.eventName)) {\r\n                subscriber.handler.call(subscriber.context, data);\r\n            }\r\n        }, 0);\r\n    });\r\n};\r\n\r\nSubscriber.prototype.triggerSync = function(eventName, data) {\r\n    var subscribers = this.get(eventName)\r\n        .concat(this.get('*'));\r\n\r\n    subscribers.forEach(function (subscriber) {\r\n        subscriber.handler.call(subscriber.context, data);\r\n    });\r\n};\r\n\r\nSubscriber.prototype.get = function get(eventName) {\r\n    if (!this._subscribers[eventName]) {\r\n        this._subscribers[eventName] = [];\r\n    }\r\n    return this._subscribers[eventName];\r\n};\r\n\r\nSubscriber.prototype.isHandlerAttached = function isHandlerAttached(handler, eventName) {\r\n    return this.get(eventName).some(function(subscriber) {\r\n        return handler === subscriber.handler;\r\n    })\r\n};\r\n\r\nmodule.exports = Subscriber;\r\n\r\n","'use strict';\r\n\r\n/**\r\n * noop a empty function\r\n */\r\nfunction noop() {}\r\n\r\n/**\r\n * validate if is not validate will return an Error with the message\r\n *\r\n * @param {boolean} isValid\r\n * @param {string} message\r\n */\r\nfunction validate(isValid, message) {\r\n    return isValid ? null : new Error(message);\r\n}\r\n\r\nvar timeouts = {};\r\n/**\r\n * clearCallbackTimeout\r\n *\r\n * @param {function} func handler to remove\r\n */\r\nfunction clearCallbackTimeout(func) {\r\n    var timeout = timeouts[func];\r\n    if (timeout) {\r\n        clearTimeout(timeout);\r\n        delete timeouts[func];\r\n    }\r\n}\r\n\r\n/**\r\n * callbackTimeout if the onSuccess is not called and returns true in the timelimit then onTimeout will be called\r\n *\r\n * @param {number} timer\r\n * @param {function} onSuccess\r\n * @param {function} onTimeout\r\n */\r\nfunction callbackTimeout(timer, onSuccess, onTimeout) {\r\n    var callback, timeout;\r\n\r\n    timeout = setTimeout(function () {\r\n        onSuccess = noop;\r\n        delete timeout[callback];\r\n        onTimeout();\r\n    }, timer);\r\n\r\n    callback = function () {\r\n        // TODO avoid leaking arguments\r\n        // https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#32-leaking-arguments\r\n        if (onSuccess.apply(this, arguments)) {\r\n            clearCallbackTimeout(callback);\r\n        }\r\n    };\r\n\r\n    timeouts[callback] = timeout;\r\n\r\n    return callback;\r\n}\r\n\r\n\r\n/**\r\n * createElementInEl\r\n *\r\n * @param {HTMLElement} parent\r\n * @param {string} tagName\r\n * @param {string} id\r\n */\r\nfunction createElementInEl(parent, tagName, id) {\r\n    var nEl = document.createElement(tagName);\r\n    if (id) nEl.id = id;\r\n    parent.appendChild(nEl);\r\n    return nEl;\r\n}\r\n\r\n/**\r\n * createIframeWithContent\r\n *\r\n * @param {HTMLElement} parent\r\n * @param {string} template simple template using {{var}}\r\n * @param {object} data\r\n */\r\nfunction createIframeWithContent(parent, template, data) {\r\n    var iframe = createIframe(parent, null, data.zIndex);\r\n    if (!setIframeContent(iframe, simpleTemplate(template, data))) return;\r\n    return iframe;\r\n}\r\n\r\n/**\r\n * createIframe\r\n *\r\n * @param {HTMLElement} parent\r\n * @param {string} url\r\n */\r\nfunction createIframe(parent, url, zIndex) {\r\n    var nEl = document.createElement('iframe');\r\n    nEl.src = url || 'about:blank';\r\n    nEl.marginWidth = '0';\r\n    nEl.marginHeight = '0';\r\n    nEl.frameBorder = '0';\r\n    nEl.width = '100%';\r\n    nEl.height = '100%';\r\n    setFullSizeStyle(nEl);\r\n\r\n    if(zIndex){\r\n        nEl.style.zIndex = zIndex;\r\n    }\r\n\r\n    nEl.setAttribute('SCROLLING','NO');\r\n    parent.innerHTML = '';\r\n    parent.appendChild(nEl);\r\n    return nEl;\r\n}\r\n\r\nfunction setFullSizeStyle(element) {\r\n    element.style.position = 'absolute';\r\n    element.style.left = '0';\r\n    element.style.top = '0';\r\n    element.style.margin = '0px';\r\n    element.style.padding = '0px';\r\n    element.style.border = 'none';\r\n    element.style.width = '100%';\r\n    element.style.height = '100%';\r\n}\r\n\r\n/**\r\n * simpleTemplate\r\n *\r\n * @param {string} template\r\n * @param {object} data\r\n */\r\nfunction simpleTemplate(template, data) {\r\n    Object.keys(data).forEach(function (key) {\r\n        var value = (typeof value === 'object') ? JSON.stringify(data[key]) : data[key];\r\n        template = template.replace(new RegExp('{{' + key + '}}', 'g'), value);\r\n    });\r\n    return template;\r\n}\r\n\r\n/**\r\n * setIframeContent\r\n *\r\n * @param {HTMLIframeElement} iframeEl\r\n * @param content\r\n */\r\nfunction setIframeContent(iframeEl, content) {\r\n    var iframeDoc = iframeEl.contentWindow && iframeEl.contentWindow.document;\r\n    if (!iframeDoc) return false;\r\n\r\n    iframeDoc.write(content);\r\n\r\n    return true;\r\n}\r\n\r\n\r\n/**\r\n * extend object with keys from another object\r\n *\r\n * @param {object} toExtend\r\n * @param {object} fromSource\r\n */\r\nfunction extend(toExtend, fromSource) {\r\n    Object.keys(fromSource).forEach(function(key) {\r\n        toExtend[key] = fromSource[key];\r\n    });\r\n    return toExtend;\r\n}\r\n\r\n\r\n/**\r\n * unique will create a unique string everytime is called, sequentially and prefixed\r\n *\r\n * @param {string} prefix\r\n */\r\nfunction unique(prefix) {\r\n    var count = -1;\r\n    return function () {\r\n        return prefix + '_' + (++count);\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    noop: noop,\r\n    validate: validate,\r\n    clearCallbackTimeout: clearCallbackTimeout,\r\n    callbackTimeout: callbackTimeout,\r\n    createElementInEl: createElementInEl,\r\n    createIframeWithContent: createIframeWithContent,\r\n    createIframe: createIframe,\r\n    setFullSizeStyle: setFullSizeStyle,\r\n    simpleTemplate: simpleTemplate,\r\n    setIframeContent: setIframeContent,\r\n    extend: extend,\r\n    unique: unique\r\n};\r\n\r\n"]}